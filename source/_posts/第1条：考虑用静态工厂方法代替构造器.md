---
title: 第1条：考虑用静态工厂方法代替构造器
date: 2019-01-11 17:22:39
categories: "Effective Java" #文章分類目錄 可以省略
tags: #文章標籤 可以省略
     - Effective Java
---
通常我们创建对象有两种方法：

1. 通过类共有的构造器
2. 使用类的静态方法返回一个实例对象

其中静态工厂方法又叫简单工厂模式，与工厂模式不同，其是通过专门定义一个类来负责创建其他类的实例，其实例通常拥有共同父类，其普遍实现主要依靠 Java 的反射机制。举个例子，如下是 Boolean 类的 valueOf 方法，将 boolean 基本类型值转换成了一个 Boolean 对象引用：

``` java
public static Boolean valueOf(boolean b) {
    return b ? Boolean.TRUE : Boolean.FALSE;
}
```

## 静态工厂方法相较于构造器的的优势

### 静态工厂方法可自定义名称

由于语言的特性，Java 的构造函数都是跟类名一样的。这导致的一个问题是构造函数的名称不够灵活，经常不能准确地描述返回值，在有多个重载的构造函数时尤甚，如果参数类型、数目又比较相似的话，那更是很容易出错。

而静态工厂方法则没有此限制，取不同的名字以表示不同的构造方式，提高代码的可读性。

### 不必在每次调用的时候都创建一个对象

使用构造器，每次都会产生一个新的对象。而静态工厂方法，可以重复地返回预先创建好的对象。常见于单例模式中。

上面 Boolean 就是一个非常好的例子，TRUE 和 FALSE 两个变量都是预先创建好的，而且都是不可变的 final 对象，这样就可以避免创建不必要的对象。

### 可以返回原返回类型的任何子类型的对象

如果使用构造器，只能返回一种类型的对象。而通过静态工厂方法，可以根据需要返回该类型的任意子类对象。遵循了设计模式的基本原则『里氏替换』（子类可以替代父类出现）。

### 在创建带泛型的实例时，代码更加简洁（java7 已修复）

这条主要是针对带泛型类的繁琐声明而说的，需要重复书写两次泛型参数：

``` java
//使用构造器创建
Map<String, List<String>> m1 = new HashMap<String, List<String>>();
```

而通过调用 HashMap 提供的静态工厂方法 newInstance，可以把代码精简为：

``` java
//使用静态工厂方法创建
Map<String, List<String>> m2 = HashMap.newInstance();
```

不过从 java7 开始，这种方式已经被优化过了 —— 对于一个已知类型的变量进行赋值时，由于泛型参数是可以被推导出，所以可以在创建实例时省略掉泛型参数。

``` java
Map<String,Date> map = new HashMap<>();
```

所以这个问题实际上已经不存在了。

## 静态工厂方法的缺点

### 如果类不含 public 或 protect 的构造器，将不能被继承

如下类，不能被其它类继承：

``` java
class MyMap<K,V> {
    /**
     *
     */
    private MyMap()
    {

    }

    public static <K,V> MyMap<K,V> newInstance(){
        return new MyMap<K, V>();

    }
}
```

### 和静态方法实际上没有任何区别

静态工厂方法本质和静态方法没有区别，为了区别，应当遵守标准的静态工厂命名习惯。以下是一些惯用名称：

* valueOf/Of ——类型转换，返回的实例和入参具有相同的值，比如 Boolean.valueOf()、EnumSet.valueOf()
* getInstance —— 返回一个预先创建好的实例
* newInstance —— 返回一个新的实例

## 静态工厂方法和工厂方法模式的区别

注意，这里的静态工厂方法与设计模式里的工厂方法模式不是一个概念：

静态工厂方法通常指的是某个类里的静态方法，通过调用该静态方法可以得到属于该类的一个实例；

工厂方法模式是一种设计模式，指的是让具体的工厂对象负责生产具体的产品对象，这里涉及多种工厂（类），多种对象（类），如内存工厂生产内存对象，CPU工厂生产CPU对象；

不过，如果要说相似的话，静态工厂方法跟简单工厂模式倒有那么点像，不过区别也挺大，简单工厂模式里的静态工厂方法会创建各种不同的对象（不同类的实例），而静态工厂方法一般只创建属于该类的一个实例（包括子类）；

## 总结
总体来说，我觉得『考虑使用静态工厂方法代替构造器』这点，除了有名字、可以用子类等这些语法层面上的优势之外，更多的是在工程学上的意义，我觉得它实质上的最主要作用是：能够增大类的提供者对自己所提供的类的控制力。

本文是 *《Effective Java》* 的读书笔记，内容主要还是来自书上和网上整理的内容。

## 感谢

[考虑使用静态工厂方法替代构造方法](https://www.cnblogs.com/chenpi/p/5981084.html)

[关于 Java 的静态工厂方法，看这一篇就够了！](https://www.jianshu.com/p/ceb5ec8f1174)